<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProtoPie Bridge Viewer</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>üß≠ ProtoPie Bridge ‚Äì Viewer temps r√©el</h1>
    <div id="viewer">
      <div id="cursor"></div>
    </div>

    <script>
      const viewer = document.getElementById("viewer");
      const cursor = document.getElementById("cursor");

      const evtSource = new EventSource("/events");

      let lastUpdate = 0;
      evtSource.onmessage = (event) => {
        const data = JSON.parse(event.data);
        const now = Date.now();

        // √âvite d'inonder le DOM avec trop de frames
        if (now - lastUpdate < 16) return; // ~60fps
        lastUpdate = now;

        if (data.x !== undefined) cursor.style.left = `${data.x}px`;
        if (data.y !== undefined) cursor.style.top = `${data.y}px`;
      };

      evtSource.onerror = () => {
        console.warn("‚ö†Ô∏è Perte de connexion SSE...");
      };
    </script>
  </body>
</html>
