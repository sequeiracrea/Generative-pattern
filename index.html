<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Circle Web Embed</title>
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#111; }
    #circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: #00aaff;
      position: absolute;
      top: 0;
      left: 0;
      transition: all 0.05s linear;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="circle"></div>

  <script>
    // SSE : écouter les événements depuis Render/Bridge
    const evtSource = new EventSource("https://protopie-bridge.onrender.com/events");
    const circle = document.getElementById("circle");

    evtSource.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        circle.style.left = `${data.x - circle.offsetWidth/2}px`;
        circle.style.top = `${data.y - circle.offsetHeight/2}px`;
      } catch(err) {
        console.error("Erreur parsing SSE :", err);
      }
    };

    evtSource.onerror = (err) => {
      console.error("SSE connection error:", err);
    };

    // Sélectionne le cercle
const circle = document.getElementById("circle");

// Écoute les messages venant de Connect (via ProtoPie)
window.addEventListener("message", (event) => {
  const data = event.data;
  if (!data || !data.name) return;

  // Vérifie qu'on reçoit bien le message du type "mouse_move"
  if (data.name === "mouse_move") {
    const x = parseFloat(data.x);
    const y = parseFloat(data.y);

    // Déplace le cercle
    circle.style.left = `${x - circle.offsetWidth / 2}px`;
    circle.style.top = `${y - circle.offsetHeight / 2}px`;
  }
});

  </script>
</body>
</html>
